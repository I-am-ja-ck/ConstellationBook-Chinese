翻译中文：



链键密码学

签名 数字签名方案是一种非常传统的公钥密码体制，在该体制中，只由签名者持有的秘密键用于在消息上生成数字签名，而公钥(对所有人开放)可用于高效验证消息上的数字签名。这样的方案所实现的基本安全属性是，在不明确调用带有相应秘密键的签名算法的情况下，不能在消息上创建有效的签名。

阈值签名方案是一种数字签名方案，其中秘密签名键永远不会存储在一个位置(这会成为单点故障)。相反，秘密键被有效地分成秘密份额，每个秘密份额存储在不同的机器上。要签署一条消息，这些机器必须同意签署该消息并相互协调以分布式方式生成数字签名(重要的是，不要在一个位置重新构造秘密签名键)。

链键技术 尽管阈值签名方案是一项存在已久的技术，但IC是第一个在其设计核心中全面集成此技术的区块链。如上所述，该技术实现了链键密码学及其所有好处 —— 高效验证区块链输出、IC拓扑的自主演化、为canister提供不可预测和无偏置的伪随机数。

IC中的每个子网都与这样一个阈值签名方案的公钥验证相关联。

更重要的是，该公钥可用于验证IC的输出，包括来自外部用户的入口消息的响应，以及来自一个canister到另一个canister的消息。这是IC与其他区块链之间的基本区别之一:其他区块链的状态只能通过从创世块运行整个协议来验证，而在IC上，只需验证单个数字签名就可以验证。因此，这是IC实现前所未有的可扩展性的关键技术之一。

该公钥也用于定期验证子网的整个状态，这启用了许多功能，例如向子网添加新节点并允许崩溃的节点快速赶上其他节点。这增强了IC的可扩展性，对于NNS协调的IC拓扑随时间自主演化至关重要。

此外，这些阈值签名可用作创建不可预测伪随机数源的一种方式，它有两种用途:

* 作为不可预测和无偏置伪随机数源，可供任何智能合约使用，这在区块链世界中是绝无仅有的，可实现在其他区块链上不可能实现的应用程序(例如NFT抽奖);
* 作为伪随机选择IC共识协议中的领导者的机制，这增强了共识的效率和公平性。

实现 IC实现的阈值签名方案是著名的BLS签名方案的阈值版本。使用BLS签名方案的一个原因是它是唯一一个产生非常简单高效的阈值签名协议的方案。事实上，持有秘密签名键份额的机器可以很容易地对消息生成签名份额，这些签名份额可以组合成消息上的BLS签名——这些机器不需要进一步交互。

选择BLS签名方案的另一个原因是签名是唯一的，这意味着对于给定的公钥和消息，只有一种有效的签名。该唯一签名属性对于生成智能合约的不可预测且无偏置的伪随机数的应用至关重要:在智能合约请求伪随机数(而不是之前!)之后，会对一个特殊消息生成签名，并将该签名通过哈希函数传递以派生用于生成所需伪随机数的种子。通过签名方案的安全性，无法预测或偏置此种子或派生的伪随机数。

尽管使用阈值BLS签名非常简单，但设计一种安全的分散式协议来生成和分发秘密签名键份额——即分布式密钥生成(DKG)协议——仍然是一个挑战。虽然DKG设计方面的研究颇丰，但现有文献中的绝大多数DKG协议都不符合互联网计算机的严格要求，即它们要么假设同步网络(这意味着如果消息意外延迟，协议将失败或变得不安全)，要么不提供健壮性(这意味着如果单个节点崩溃，则完全失去产生签名的能力)，有时两者都有。在IC上，这两个假设都是不可接受的:即使在异步网络与许多故障节点的情况下，安全性和活力也必须保持。

DFINITY设计、分析并实现了一种新的DKG协议，可在异步网络上运行，并且相当健壮(即使子网中多达三分之一的节点崩溃或损坏，它仍然会成功)，同时仍能提供可接受的性能。除了生成新密钥之外，该协议还可以用于重新共享现有密钥。随着时间的推移，随着子网成员关系的变化，这对于实现IC拓扑的自主演化至关重要。







关于上述引用的线程，我想分享一些技术解释，以帮助澄清讨论，并提供一些考虑的要点。我将首先解释第一代和第二代区块链为什么和如何支持本地处理区块和交易，然后解释第三代区块链(如互联网计算机)为什么使用不同的模型，不需要使用“本地节点”等在本地处理区块。最后，我会提出在特定情况下添加该功能涉及的一些技术问题，例如使用网络神经系统DAO，并提出使所有数据及其交互完全透明所涉及的一些社会、安全和监管问题。

为什么第一代和第二代区块链涉及本地处理区块

第一代(例如比特币)和第二代(例如以太坊)区块链提供了一种安全互动模型，第三代区块链无法使用。它们的网络维护所有添加到链上并处理过的交易区块的副本。当一方希望以不信任某些中心化行为者(如加密交易所、Infura或Alchemy)的方式安全地与区块链交互时，他们必须下载这些区块副本，并在本地重新运行所有交易以构建其当前状态的副本。由于所涉及的区块链协议使验证下载的区块是否代表正确的链成为可能，该方随后会知道他们正在与状态的正确副本进行交互，他们还可以看到过去的加密货币转账，以及智能合约计算的结果等。这使他们能够安全地交互，例如通过创建新交易。

自托管(“去中心化”)比特币钱包必须下载区块链的过去区块，并重新运行其中包含的交易来计算其比特币余额并获得发送和接收的交易。同时，使用以太坊等创建Web3服务的人通常会在云帐户(例如亚马逊网络服务提供的帐户)上通过安装网络服务器、数据库和以太坊“本地节点”来构建网站，该节点下载其区块并重新运行交易以创建可与网站代码交互的智能合约和数据的可信本地副本。随着时间的推移，一个关键问题随之出现，那就是随着这些区块链的增长，下载区块并重新运行其交易的成本越来越高。

早在2013年，我就记得我的自托管比特币钱包初始化需要几个小时，而今天以太坊本地节点在启动时通常需要几天，即使在非常强大的计算机上运行。由于这个关键问题，现在很少有人使用传统的自托管比特币钱包，即使使用时，他们也会选择依赖最近的状态检查点的自托管钱包，这涉及信任检查点创建者，或者更糟，更常见的是，他们只是将比特币保存在FTX等中心化加密交易所上。同时，绝大多数以太坊开发者现在只是使用与Infura和Alchemy等中心化区块链基础设施服务交互的代码来构建区块链网站，选择信任他们作为运行本地节点成本的权衡，希望这些服务没有被黑客攻击也不是恶意的，并且也信任这些服务本身运行的云。

出于这些原因，第一代和第二代生态系统中的大多数参与者不再以无信任和去中心化的方式验证与其区块链的交互，而是依靠信任中心化行为者。这不仅降低了他们的安全性和弹性(例如，Infura由于亚马逊网络服务中断而遭遇了宕机)，而且还使他们面临被中断的风险，例如监管机构可能对那些中心化行为者施加条件。这意味着成为现状的架构远非理想，第三代区块链构建者需要摆脱这种旧模式。但是，引用的线程讨论为互联网计算机添加了目前不支持的这种传统模式的支持，以便在特定情况下使用，

第三代区块链为什么不能轻松使用旧模型

由于第三代区块链(目前只有互联网计算机)必须大规模操作，因此它们无法轻松使用旧模型。以太坊每秒只处理几笔交易，而互联网计算机最近已经每秒处理了一万多笔交易，我们希望有一天它将每秒处理数百万或数十亿笔交易。事实上，该网络已经处理了超过15亿个区块，总有一天它将处理四万亿个区块。很难看到开发人员如何经济地运行本地节点，这些节点可以下载如此大量的区块并重播它们的交易。此外，区块链存储每一个过去的区块以供本地节点后续下载也将非常昂贵。

旧模型不太适合的另一个原因是，第三代区块链必须托管能够直接安全地向最终用户提供内容的智能合约，包括将内容传输到网页浏览器中，然后网页直接与托管的智能合约交互，关闭循环——因为这是获得所需的真正端到端去中心化所必需的，以实现安全性、活力和防审查的目的，并允许Web3服务完全在链上运行在社区DAO的绝对控制之下，实现关键的Web3承诺。即使以某种技术上可行的方式在网页浏览器中透明地嵌入本地节点，也许通过使用零知识证明等使本地节点更高效，从而可以使用旧模型的混合来启用直接交互，但这也令人怀疑是否有人想要这样!

从“子网区块链”形成区块链

互联网计算机不需要旧模型，但要理解为什么，需要理解它如何由“子网区块链”形成，以及它们的工作方式。每个子网为托管智能合约提供了额外的区块链容量，允许它根据需要进行扩展。整个网络由一个称为“网络神经系统”(NNS)的无许可治理DAO直接控制和管理。这会从节点机器中形成新的子网，节点机器是独立“节点提供商”拥有并在世界各地的各种地理位置和司法管辖区中的独立传统数据中心操作的特殊硬件设备。

NNS非常谨慎地创建新的子网，方法是指示互联网计算机网络中的一组节点组合，当考虑到它们的节点提供商、数据中心和位置时，这些节点足够去中心化，从而a)当涉及的网络协议将它们组合时，它们可以提供区块链所期望的必要的安全性和活力保证，同时b)可以组合尽可能少的节点以减少数据和计算的复制，从而降低运行智能合约软件的成本。存在不同类型的子网，具有不同的复制级别，用于托管具有不同保证和不同操作成本的智能合约。这种方法对互联网计算机是独有的，称为“确定性去中心化”。

NNS存在于其自己的子网上，自然地，这是在主网创世时创建的第一个子网，因为它负责创建每一个其他存在的子网。一个改变游戏规则的创新是，每个子网区块链都有自己唯一的“链键”，它用来对用户和其他子网的交互进行签名，即使在子网中添加和删除节点，公共链键也从未改变。托管NNS的子网的链键充当互联网计算机网络的“主链键”，与其他链键一样，主链键从未改变，NNS使用此主键来签署每个新子网的链键，以便它可以作为网络的一部分运行。

子网如何维护和使用其链键

链键加密是互联网计算机区块链的核心协议数学和密码术的名称，它使子网能够拥有链键。链键是使用阈值密码术方案生成的，其中涉及一个公钥和子网中不同节点持有的许多单独的“私钥份额”。这听起来很简单，但实际并非如此:复杂之处在于最初创建私钥份额，使用NIDKG(非交互式分布式密钥生成)协议和密钥重新共享协议，这允许子网在不导致其公共链键更改的情况下添加和删除节点。实际上，重新共享过程会不断运行，其目的是通过不断重新生成份额来挫败“自适应对手”，这些对手希望从节点中逐步窃取一致的阈值私钥份额。

只要有足够数量(即特定大小的子集)的节点正常操作，子网就可以使用其链键创建签名。这对区块链共识协议的运行非常重要，也用于对共识的输出进行签名，包括新处理的更新调用交易的结果以及预签名(预最终确认)经验证的查询调用交易结果的默克尔根，然后可以在不通过共识的情况下返回。阈值签名是拜占庭容错的，这意味着故障(即任意错误)节点不能阻止正确节点阈值签名，区块链协议也利用这一特性，以确保子网是拜占庭容错的(即即使其节点的一部分任意故障，它也会继续运行而没有对数据或功能的任何损坏)。

使用链键实现扩展和直接交互

鉴于当前的现状，可以想象区块链天然地允许用户下载过去的区块以验证其状态，这导致错误认为它是区块链安全的必要部分。然而，实际要求只是区块链提供一个防篡改和不可阻挡的平台，以支持自治并且由于没有中心化行为者可以做出提交合法交易以外的任何事情来更新状态而无需信任。虽然下载区块并重播交易以重构当前状态似乎是必要的，但由于过去的做法，可以设计证明数学上同样无法被破坏的其他系统，其中密码学负责验证。这就是链键加密协议为互联网计算机所做的。

链键的可用性是如何实现这一点的核心。当您的软件与互联网计算机交互时，返回的结果由托管所涉及的智能合约软件的子网的链键签名，该键又由区块链的主键签名。得益于协议数学的工作原理，如果链键签名有效，这不仅会告诉您您的交互没有被篡改，而且还会告诉您返回结果的子网区块链正在正确运行，其状态或计算也没有被篡改(这只能通过破坏所涉及的子网区块链来实现，例如，通过压倒其拜占庭容错协议的故障界限)。这意味着您不需要下载其区块并重新运行交易以确保所发生的情况。

链键签名因此使三件美妙的事情成为可能。首先，当两个托管在两个不同子网上的智能合约进行交互时，子网可以安全地传递所涉及的流量，而无需下载和处理对方的区块，因为它们可以简单地检查流量上的链键签名，以知道a)流量没有被篡改，并且b)发送方也在正确运行。这意味着可以通过组合任意数量的子网来创建一个统一的区块链环境，并且通过添加新子网来扩展容量。其次，用户软件(如网页中的JavaScript)可以通过检查链键签名上的结果来安全地直接与互联网计算机上的智能合约交互，而且，组成这样的网页的资产也可以由智能合约签名并直接提供。第三，当协议不再需要它们时，子网区块链可以丢弃它们已经处理的区块，以避免节点机器存储它们，否则如果它们每秒处理一个区块，内存可能很快就会耗尽。

总之，区块链的定义是它为托管帐本和智能合约提供的特性，例如使它们不可破解(防篡改)、不可阻止(持续保持运行)和支持自治(即独立于任何中心化方存在的令牌和智能合约，这为子特性提供支持，例如抗审查)。正是提供此类属性定义了什么是区块链，而不是用于创建区块链网络的技术机制。这意味着参与者在本地下载和处理网络区块副本以保护交互并确保维护“正确”链的副本的第一代/第二代模型，只是一种可能的技术解决方案。重要的是所涉及协议的可证明数学以及相关的安全分析，这表明提供了所需的属性。尽管链键加密无疑很复杂，但它在允许产生可扮演世界计算机角色的第三代区块链的同时满足这些要求。

进一步思考引用的线程中所说的“公共子网”

首先，值得一提的是，由于主题使用的命名法，讨论走偏了，该主题讨论了“公共子网”，这意味着今天的子网是私有的或类似的，但实际上它们都是公开的，任何人都可以访问，并在无许可的网络神经系统DAO的控制下运行。的意思是，目前的子网不允许随意访问其当前状态，智能合约可以保密其数据(即您访问不控制的智能合约内部隐藏的数据的唯一途径是通过它向您公开的逻辑)。要获得此类智能合约数据的“未经授权”访问权限，您需要获得托管它的子网中节点机器的物理访问权限(很快，当节点机器启用SNP-SEV硬件隐私技术时，滥用此类物理访问权限会变得更加困难)。此外，子网不提供对创建当前状态的先前处理的交易块的访问。

引用的帖子仅关注提供对特定子网(如托管NNS的子网)的智能合约状态和创建该状态的交易历史记录的访问权限。与此同时，“公共子网”一词的使用，意味着现有子网不是公共的，引发了相当多的讨论。关于拟议的更改，我目前对双方并无非常强烈的意见，但我将强调一些重要的考虑事项。

涉及的技术挑战

NNS子网正以每秒约1个区块的速度处理交易。如果它使这些区块可供下载，以便人们可以尝试使用第一代/第二代“本地节点”模型验证其状态，则每个运行某种本地节点的参与者每天都必须下载和处理86400个区块。根据希望这样做的人数，会产生巨大的带宽开销，这将很昂贵，目前还不清楚如何通过协议或NNS补偿节点提供商。毫无疑问，这可以解决，但网络仍将承担非常可观的额外费用。

得益于链键密码学，互联网计算机子网不需要长时间保留旧区块，这避免了不必要地填满节点机器的内存。但是，通过一些修改，节点可以保留最近的3000个区块(价值50分钟)，这将允许运行“本地节点”的节点在短暂断开连接后重新同步。但是，每次同步/重新同步都将非常昂贵:a) 首先，正在同步的“本地节点”必须开始下载整个状态的检查点“快照”，同时存储从那时起的每个流式传输区块，然后将收集的区块应用于完全下载的快照状态以赶上进度，b) 断开连接超过50分钟的任何“本地节点”都必须重新启动此昂贵的过程。这放大了传输区块所涉及的带宽开支，并可能产生DDoS漏洞，攻击者可以针对该漏洞进行攻击。此外，即使每小时只创建一个快照(并丢弃先前的快照)，这也会使子网上可以存储的状态量减半。

互联网计算机最神奇的地方之一在于它是自我更新的。也就是说，可以向NNS DAO提交提案，使用某些引用的源代码生成的新二进制映像更新协议，如果提案被采纳，则该映像随后用于更新网络中的节点机器——完全自动化。这里的问题在于，随着协议设计和实现的发展，区块的含义和处理方式可能会发生变化。这意味着(如果不付出疯狂的工程努力)要创建一种“本地节点”系统，今天可以记录状态快照，之后记录数周、数月或数年的每个区块，这将足以重新创建当前状态，因为每当达到协议升级发生的区块高度时，逻辑都必须更改。因此，同步“本地节点”将始终涉及下载小于一小时的快照，并应用后续区块——我觉得这不是这里人们真正想要的。

关于“开放”NNS的问题

基本想法是通过创建一种新类型的子网，人们将能够看到网络神经系统/NNS的内部，以及每次更新它的交易(智能合约函数调用)。

鉴于创建可以支持“本地节点”的新类型子网所涉及的上述技术挑战，如果决定NNS的内部必须向所有公开，那么有一种更简单的前进方法，它只需要极小的工作量，那就是简单地向NNS的智能合约添加功能，允许人们获取他们想要的任何内部信息。当然，仅此一项不会透露与NNS交互以提供所公开信息的交易(即用户如何与NNS交互)。但是，通过一些更实质性的工作，我们还可以向NNS添加日志记录，以便任何人在NNS内所做的任何事情，例如质押神经元、配置关注或投票，都会保留，例如保留几天，并公开。由于互联网计算机的链键密码技术为子网区块链提供了防篡改功能，因此恶意行为者不可能修改通过此类API返回的信息，我们可以安全地向任何人公开所有信息。

我们必须严肃提出是否在NNS中公开人们的交互和数据真的有利于健康的民主。例如，在选举投票站投票时，你的票是匿名和私密的。可以说，出于类似的原因，你在神经元中抵押了多少资产，持续了多长时间，你关注了谁，如何对提案投票，以及例如与ICP和其他治理代币余额的联系，也应该保密。我们的社区并非对毒性免疫，那些拥有可观投票权的人可能会受到热心的狂热分子的压力，他们渴望以自己的方式说服他人改变神经元的关注和/或对特定提案投票。此外，他们甚至可能因过去的投票方式而受到指责和迫害。这样一来，安静且理性的人可能会被迫退出治理社区，他们通过投票提供的有用信息也会丢失。

公开人们在NNS中的交互和数据可能会带来安全和监管风险。首先，它会提供对攻击者准确的信息，告知他们需要怎样向谁施压、敲诈或勒索，以推进实现他们目标的提案。当歹徒参与其中时(遗憾的是哪里也不完全没有危险分子)，治理社区的参与者可能会陷入可怕和棘手的处境，坏人可能会通过推动不良提案对网络造成真正的伤害，例如，通过ICP短线获利。其次，积极的监管机构为了通过伤害互联网计算机生态系统来树立自己的名声，可能会根据他们如何投票，让治理社区中的参与者对他们不喜欢的提案的采纳负责。因此，可以说，透露此信息可能会给个人和网络带来严重风险。

总结

与区块链中的许多情况一样，深入探讨问题通常会发现它们比乍看起来更复杂。有必要详细了解技术的工作原理、它如何进行修改，并考虑潜在的监管、安全、博弈论、代币经济学、社会学和经济影响。如果我们希望这样做，使NNS的交互和数据透明所涉及的潜在研发成本和注意力分散，也必须与交付和完善许多其他功能的需求(如SNS功能或以太坊链键集成)相衡量。

最后一点评论是，我们可以更轻松地以参考线程中讨论的方向处理治理代币账本。目前，它们以区块链中的区块链的方式实现。也就是说，交易以哈希链的形式记录，其中每个交易在互联网计算机上形成一个区块。例如，这使加密交易所能够通过Rosetta API与ICP账本交互，并满足要求他们了解每笔交易的监管要求。我们可以研究修改方法，以便将最终导致交易的交互的签名与交易一起存储。这将使重新运行账本上的每笔交易成为可能，并证明某个用户没有转移他们拥有的某些代币，因此仍然应该拥有这些代币，独立于托管该账本的子网的链键密码协议说什么。请注意，即使在这里也存在不明显的挑战——如果用户最初是通过区块链心跳调用的自治智能合约的转账收到有问题的余额会是什么情况!?要点是依靠链键密码的硬性数学要容易得多。







是的，我长期以来一直认为，我们可能应该使即使是那些具有所涉节点机器物理访问权限的人也无法访问神经元的关注关系和投票(并且，由于节点机器最终会尽快打开SEV-SNP硬件隐私保护，即使是那些既具有物理访问权限又能破解该保护的人也无法访问)。

网络神经系统的起源可以追溯到2016年夏季发生在以太坊网络上的The DAO故障和黑客攻击。首先，这显示了需要更好的DAO设计，这些设计不依赖于由高知名度的人类“策展人”组成的内阁来做出决定，并使用不易被利用的机制(尽管最终，The DAO是由其Solidity代码中的一个简单的重入漏洞所利用，而不是通过其对不正当投票策略以及我担心的其他博弈论漏洞的脆弱性)。其次，由于这一故障导致以太坊网络硬分叉，因此需要一个区块链网络，该网络可以由DAO轻松定期更新，而不是由区块链内部人员组成的内阁通过矿工进行硬分叉来协调更新，考虑到硬分叉所带来的所有政治、伦理、安全问题以及纯粹的摩擦。尽管我一直在研究如何构建世界计算机，但当时的资金限制意味着我的早期雄心壮志基本局限于构建一个由DAO控制运行的以太坊姊妹版本，并对共识做一些有限的改进。

在2016年，我创建了这样一个DAO的简单概念验证实现，它实际上只是一个特权智能合约，可以访问为此目的发明的特殊以太坊操作码。不管怎样，如果你看看我2017年1月的早期“区块链神经系统”提案，你会发现我提出将神经元关注关系存储在用户设备上，在运行在神经元所有者手机上的客户端软件中。这提供了一种使神经元关注图对所有人完全不可访问的简单方法，我还提出在自动投票期间引入随机时间延迟，以便从时间上跟踪投票活动的人无法看到关注图(请记住，在简单的类似以太坊1.0的区块链上，每个单独的交易都可以下载)。

当然，如今近6年后，我希望治理工作的许多方面已经改变了最初的设想，但我个人仍然认为，使用密码学使关注图和投票完全私密具有价值。投票可以通过密码学盲化进行伪装。使用密码学伪装关注图将更具挑战性，尽管我相信如果DFINITY的密码学家致力于这个任务，他们肯定能找到实现的方法，如果不行，我们可能会退回到我的最初抄近路——这涉及创建特殊的NNS客户端软件来保存神经元关注，它将在手机和笔记本电脑上运行。

那篇原始文章表达了基本的隐私 caso:“我们在前文中没有提及的安全维度之一是隐私。神经元出于一个原因在网络边缘进行管理——在基本层面上，它使关注图和决策过程不可知，因为对手将无法收集分布在互联网上的成千上万个私人经营的客户端实例的状态。这可防止对手瞄准图中的关键节点，例如通过勒索或绑架来增加他让提案被采纳的机会。此外，这也意味着这样的关键节点不必为决策承担责任，例如被冻结系统的愤怒所有者，或认为法律责任应该源于决策的政府或机构。”

最后一点。在那篇原始文章中描述隐私需求时，我说我希望保护神经元所有者免受“冻结系统的愤怒所有者”的伤害。这不应被解释为希望支持出于政治、竞争或其他原因普遍审查智能合约的自动治理(即推进控制治理的多数投票的议程)。我具体说的是“暗杀市场”和“ISIS奴隶市场”的存在。当前，NNS不会对智能合约执行任何此类审查，这样的邪恶和高度非法系统目前仅由边界节点操作员在发现时进行屏蔽(未来，每个边界节点操作员将决定自己的黑名单以保护自己免受转发此类流量的后果)。

我坚持的意见是，暗杀市场和ISIS奴隶市场等异常行为在去中心化区块链上没有立足之地，后者的目标是充实和改善人类状况，不管怎样，我们必须开发可接受的方法来防止它们在世界计算机区块链上运行，由于其本质，后者比传统区块链强大得多。要求边界节点操作员维护黑名单的目的是将审查权下放给那些将承担转发此类流量实际后果的人(通常，数据中心在执法部门投诉后会禁用已被证明正在提供非法内容的边界节点机器，除非迅速采取补救措施)。向在早期社区讨论中提倡这种方法的所有人致敬。







稍微从不同区块链的具体工作原理中抽离出来，我们可以概括地说，所有好的区块链都是拜占庭容错(BFT)网络的版本。也就是说，它们使用协议数学，只要“故障”节点(即可以任意行为的节点，包括离线、数据损坏、颠覆协议以及以任何方式与其他故障节点勾结)的比例保持在定义的“故障界限”以下，则网络将继续正确运行。

我们关心的是活力丢失的概率，或者对手可能导致某些无效状态转移的概率。我们也关注特定类型攻击的漏洞，例如DDoS，这可能导致网络失去活力等。为了理解概率，我们必须对协议进行数学分析，并分析给定使用的特定网络模型时超过故障界限的概率。我们在这里必须谨慎，因为BFT协议、密码学和复杂网络设计方面的各个方面的数学分析以及关于故障界限的推理都是困难的，这导致了一些简单的区块链设计准则的存在，这些准则易于理解，但常常被误解为设计的必要和不可变规律。互联网计算机社区经常遇到这些准则，因为它采用了与区块链设计的几乎所有方面完全不同的方法。

正如我在本主题之前的文章中所提到的，我们必须通过其可提供的平台属性来定义“区块链”，例如防篡改、不可停止和支持自治，而不是通过特定的设计方式，包括某人是否可以自己验证处理的交易的签名来增加安全性。重要的是区块链提供保证，例如无效交易不会被处理等，这需要更复杂的分析。互联网计算机是第三代区块链，它在几乎所有方面都与早期区块链不同，但它非常好地提供了定义区块链的关键属性。

关于所使用的子网区块链设计，我认为您暗示的是，如果子网区块链的大部分节点发生故障(即被对手控制)，则它们可以在原则上修改子网的状态而不被检测到。从理论上讲，这是正确的 - 但任何理论可能性最重要的不是其潜在影响，而是它可能发生的概率。此外，我们在这里讨论的只是一旦区块链网络的故障界限被超过并且其拜占庭容错停止工作时可能遇到的许多故障模式之一。例如，尽管合并大量验证者检查每个交易和状态转换的合法性的区块链网络可以防止未被观察到的不良行为，但它们通常更容易受到对手控制其网络的影响，如果发生这种情况，执行检查的验证者也无法阻止创建重新排序交易的新分支，可能允许对手双花大量代币转账或在DeFi中制造某种混乱以获利。即使这样的网络的故障界限没有超过，简单的设计缺陷也可能导致这个或那个问题，就像我们在以太坊的矿工可提取价值(MEV)中看到的那样。所有潜在问题的重要性在一定程度上取决于它们可能造成的影响及其发生的可能性。

那么我们必须问的问题是，互联网计算机上的一个“受信子网”被破坏的可能性有多大，以至于它可以在未被注意的情况下进行非法状态转换。这样的子网目前由至少34个节点机器组成，尽管所使用的协议实际上非常好地扩展，并且如果需要的话，允许使用数百个节点构建子网。所涉及的节点由NNS使用确定性去中心化系统选择。这意味着它们由独立的节点提供商拥有和操作，并安装在不同地理位置和司法管辖区的不同数据中心中。这与随机选择典型权益证明网络中的匿名节点非常不同，在这种网络中，对手可能运行大量节点 —— 以便如果对一组节点的随机选择不幸，几乎所有节点都可能属于对手。此外，自适应对手会发现很难破坏诚实节点(或者更具体地说，它们的所有者)。节点提供商不是匿名的，如果他们恶意勾结并被发现，他们可能会为其行为承担责任，任何被破坏自适应对手接触的节点提供商都可能只假装是可腐蚀的，继续以钉子户的方式行事以揭露他们的行动。此外，当节点提供商是公司时，组织内的许多人可能会选择告发可疑活动。

互联网计算机子网是3f+1拜占庭容错的(根据简单的数学，这是异步网络中可以做到的最好的容错率1)，这意味着节点故障不到三分之一才能确保不发生问题。但是，这并不意味着如果子网的三分之一或更多节点发生故障，就一定会出现问题。需要超级多数节点使网络运行，即2f+1个节点。由于f是11，超级多数是23个节点。如果对手想要秘密地修改网络，他们需要安装至少23个故障节点，这将a)停止与其余11个正确节点交谈，b)执行所需的非法状态转换，并且c)在足够长的时间段后再次与正确节点对话，以便强制它们使用非法创建的状态进行重新同步，而不是通过重新运行最近的缓存区块来赶上进度。问题是，鉴于上述确定性去中心化的性质，自适应对手破坏23个节点提供商并使其节点机器运行的修改软件的可能性有多大，而不被检测到。我们声称这种可能性极小。

在讨论PoS区块链以解释为什么它们需要更多验证节点之前，让我们首先回顾一下互联网计算机子网区块链协议使用的三层共识机制，并考虑仅通过添加节点可以实现什么来增加安全性，而无需创建外部验证者系统。

第一层是随机数生成器，称为阈值中继，它使用BLS阈值签名(每个签名本身都是阈值签名以生成下一个随机数)生成随机数，因为BLS签名是唯一的和确定性的。第二层是一种高度一致的区块链协议，称为概率时隙共识，它由随机数驱动。只有完全验证的区块才能添加到链中。第三层最终确认链中的区块，称为乐观异步最终确认程序，如果成功，它会即时确认区块最终确认，这样它们就不会被新分支超过，无需等待区块埋在一定深度才确定。节点(“复制品”)只在区块被第三层最终确认后才处理区块中的交易，这意味着节点在分支崩溃后永远不需要“回退”其状态。

第二层(区块链)添加到链中的区块必须由2f+1个超级多数签名，这证明它们不包含无效交易(即没有违反规则的交易，也没有错误签名的交易)。如果正确的节点收到无效区块，则该区块上故障节点的签名将创建不可争辩的密码证据，证明故障节点确实发生故障。所以为了非法推进链，它们需要超级多数，但为了排除正确的节点以防止它们见证，它们还需要超级多数。排除正确节点无可避免地会引起注意，但这是另一回事。

我不想在这里走得太深，但这里的要点是，与修改体系结构不同，如果我们想要/需要增加子网安全性，并减少某个对手可能这样做的机会，最简单的方法就是简单地添加更多节点，而不是采用过时的验证者模型。通过增加子网的大小从而增加它们必须腐败的节点提供商数量，可以使其对对手来说非常困难去腐败一个2f+1个故障节点的超级多数。例如，如果有1000个来自1000个节点提供商的节点机器会发生什么情况!肯定不可信的是，对手能够设法贿赂667个节点提供商，并说服他们勾结，而所有这些都没有被举报和捕获。这里的要点是安全性存在于一个成本曲线上，之后，安全性变得如此之强，以致额外的支出几乎没有收益。尽管我们可以通过添加其他节点使子网安全性任意强大，但添加每个额外节点的收益会减少，而添加新节点所涉及的额外费用以及因此在另一个硬件设备上复制协议密码和智能合约数据和计算保持不变。在某些时候就没有意义了。

最后，值得简要介绍一下为什么传统区块链需要这么多验证节点。在撰写本文时，以太坊有488，586个验证节点在吸收以太坊区块，并检查它们是否格式正确，从而复制账本及其货币交易和智能合约数据和计算488，586次。这难以置信的昂贵。这些验证节点在绝大多数情况下实际上只是在集中式云服务上运行的软件实例，而不是专用硬件，但假设将它们排成一排，间隔1米，那么这条线的长度将是惊人的488公里。任何人都可以看出这需要大量检查，作为一名加密理论家，我当然很难为这样的费用找到很好的理由。但是，尽管以太坊在安全方面不需要如此大量的验证节点，但一般来说，由匿名验证节点托管的权益证明网络确实需要比使用确定性去中心化的网络更多节点来实现安全目的。

首先，这样的网络需要防止“女巫攻击”。当对手是匿名的时，这些攻击会发生，对手可以不断添加故障节点到网络中，直到他超过了故障界限，并使网络做坏事。例如，对手可能通过黑客攻击累积大量该区块链的原生加密货币代币，然后使用它来启动大量验证节点。为了防止他创建足够的验证节点以超过网络的故障界限，网络需要由大量验证节点(我们将其视为股权的代理)托管，这将使其太昂贵，无法达到故障界限，因为他最终会用完资源。从这个意义上说，由匿名节点托管的权益证明网络与传统的工作证明网络相似(互联网计算机是有用工作证明，这很不同)，后者要求矿工进行大量的哈希运算，这使恶意矿工获取总算力的51%以实现双花攻击或停止链条变得不可行。显然，如果您想提升至下一级并提供世界计算机区块链，那么这种方法不是一个好主意。

其次，在这种网络中，由Beacon Chain等随机选择来构建分片或较大共识委员会的节点子集包含超过协议故障界限的故障节点/验证者数量的概率是使用超几何概率计算的(您可以在这里找到一个很好的在线超几何计算器1)，因为节点的匿名性总是使它们的选择是随机的。这有点像有一个装满蓝色弹珠的袋子，蓝色代表正确，红色代表故障，然后在不看的情况下从袋子里抽取一些，不替换，然后看红色弹珠的比例是否太高。例如，如果使用2000个由女巫攻击者创建的故障节点从5000个节点中动态创建包含34个节点的分片，则故障节点数>11的概率为1-0.2322786150022 = ~77%。这显然是不可接受的，这也是为什么权益证明网络需要大量验证节点的另一个原因，通过费用来约束女巫攻击者可以添加的故障节点的比例，并且必须使用更大的组大小。例如，如果以太坊有450，000个节点(为了更简单的数学，我们假设它们有相等的股权)，其中只有50，000个属于资源受限的对手的女巫攻击之后，那么Beacon Chain随机选择的115节点共识委员会包含>38个故障节点的概率为1-0.9999999999817 = 0.00000000778%，这很好。

重要说明:担心权益证明网络中可能存在大量属于对手的节点的担忧并非危言耸听。权益证明“验证节点”几乎总是可以在云服务上运行，这使得通过运行脚本在几秒钟内启动成千上万个节点变得很容易，可能使用通过黑客攻击获得的股权(与启动专用物理硬件设备(如互联网计算机节点机器)的难度相比，后者必须构建或购买，然后配置，然后安装在数据中心，这还将涉及为所使用的机架安排最短期合同)。此外，运行验证者的云服务或某个恶意员工暗中控制验证者节点本身的重大风险，并将它们变成按照他们的意愿行事的丧尸。事情可能会出错的潜力最近由Hetzner展示，他们轻轻一按就在瞬间关闭了1000多个Solana验证者，这一数字占Solana网络的40%。







这纯粹是因为下面第三点吗(即验证复制状态)?

(重新发帖，因为没有引用上面的@jzxchiang)

是的，这是一个例子。请注意，对于某些事情来说，f+1就足够了，因为a)子网中假设最多有f个故障节点，所以b)大小为f+1的法定人数至少会包含1个正确节点。但这只适用于不可能出现“曲解”的情况，例如在随机信标的生产中。在该应用程序中，只能有一个先前的随机数/签名来签名，因为BLS是唯一和确定性的，之后的签名(这是一个随机数)对该先前数字也将是唯一和确定性的，这样就不可能出现分叉(它为你提供了一系列数字的共识，而不需要共识...)。所以没有回旋的余地。但是，当你进入共识协议时，情况就变了，因为故障节点可以进行equivocate。例如，故障节点可以签署两个不同的状态、区块或最终确认，等等，适当分区的正确节点(无法看到两种状态)可以被诱导帮助签署两者(假设网络是异步的，所以在理论上，仅仅偶然，无论如何，正确的节点可能检测不到“分叉”，但模型也考虑了对手可以干扰网络上的消息传递，以允许他们的计划继续进行)。惟一的方法是要求2f+1个签名。顺便说一下，这个结果背后的数学非常简单，在异步网络中(消息传递时间不受保证)没有办法绕过它。许多区块链的设计方式假装这个结果不存在，通常是因为建筑师似乎由于某些原因不知道这个结果。我们知道Solana就是这种情况，这就是为什么当Hetzner关闭其40%的节点(超过三分之一)时它仍在运行的原因。结果是，简单的网络扰动和节点以不同速率处理TX会导致它出错并分叉，这已经相当常规了，而且随着时间的推移，向其网络添加修改后的验证器来按需分叉其链将非常容易。

如果在导致节点提供商潜在泄露数据的节点机器上没有正确设置SEV会怎么样?

节点机器的SEV-SNP硬件证明虚拟机正在“安全区”内运行副本/客户端软件。如果不是这种情况，就没有办法让SEV-SNP硬件进行证明。这就是为什么它可以防止任何具有物理访问权限的人访问数据，包括节点操作员(至少可以防止任何无法破解SEV-SNP的人)

这只是社会证明的问题。人们习惯于用一种方式做事，并推断出因为每个人都是这样做的，所以这是唯一的方法。但根据数学和科学，这对于安全性来说绝对不是必需的。

他们应该更担心其他链上的事实:a)他们在云上运行用户体验或使用云，这使他们如BadgerDAO所示容易遭到黑客攻击，并受到监管机构等的指责，b)他们通常会维护一个中心化的“管理员后门”主密钥，这使得团队成员可能会变节，他们可以使用更复杂的DAO比如SNS来解决这个问题。

确实有些DeFi服务需要跟踪使用情况以避免监管压力。现行模型确实允许通过区块链浏览器(如Etherscan)来完成这项工作，而无需开发人员做任何额外工作。但是这种历史记录跟踪对真正的用户来说是一个可怕的体验，只适合区块链分析侦探。

如果DeFi服务希望使关键事件和交易透明(这通常非常可取)，那么更好的方法就是在DeFi智能合约内记录关键事件和交易，然后为日志提供一个漂亮的UI。

请注意，像DEX这样的东西已经希望记录交易，因为用户会想知道他们的交易是如何发生的等等。想象一下必须去Etherscan找出你的交易在类似ICDEX上的执行方式。那将是一场噩梦。

最后说明一点:在互联网计算机上运行的DeFi服务也可以添加允许人们运行特定服务的本地节点的功能，这些节点可以跟踪交易/状态更改。这就是治理代币账本所做的，它的行为类似于传统区块链，可以通过Rosetta API进行访问，以便像Coinbase或币安这样的CeFi交易所可以与它们对接。

关键要点是互联网计算机区块链为智能合约提供了防篡改且不间断的可扩展计算平台。该平台的力量是如此之大，以至于可以在其上构建所需的任何内容，包括日志记录，甚至支持特定服务的“本地节点”验证器设施，这些验证器可以跟踪每次更改并确保其合法性。







然而，像以太坊这样的网络的好处在于任何人都可以加入并开始验证区块。互联网计算机不是这种情况，因为成为验证者需要通过NNS进行许可。因此，目前只有节点提供者可以判断其他节点提供者执行的状态转换是否合法。

我的观点是:这一功能似乎必要和/或有益的唯一原因是“区块链社区共识”提供了误导性的社会证明，证明这在技术上是必要和好的。这导致人们觉得加密数学是不可信的，他们自己应该能够从每个子网下载每秒产生的区块，并重新运行其中包含的所有交易以复制和检查多TB的区块链状态，以确保没有任何猫腻。毕竟，既然每个区块链都是这样工作的，他们宣传保持其安全的数千个云验证者，这怎么可能不是必需的呢?

但是数学的说法与此相反(就像它与使用此模型的许多其他领先区块链的安全性一样)。最后，我们必须信任数学，坚持科学，避免使用误导性的区块链标准。通过添加一项功能，使人们可以从子网中汲取区块并复制其状态，我们实际上是在说这在技术上是必要的，进一步滋生谎言，很快人们就会认为任何不由大批本地节点复制的子网都是不安全的。

实现此功能还存在几个技术挑战(这并不是说在特殊情况下它们无法解决，例如NNS子网)。关键是节点机器无法永远存储所有过去的区块，因为它们最终会消耗掉所有内存，而所使用的数学并不要求它们这样做。这意味着，如果本地节点断开连接足够长时间，它将不得不从最近的状态进行重新同步，而不是从它错过的区块:因此，恶意子网可以在非法修改状态时简单地断开本地节点的连接，保持足够长的时间断开连接，以便它们稍后被迫从非法修改的状态重新同步，一旦本应揭示该恶作剧的区块不再可用。而且还有其他问题。互联网计算机的设计简直不是为像第一代或第二代区块链那样工作的——尽管通过大量工作我们可以找到解决方案，但为什么要这样做呢?

我还强烈质疑剥夺互联网计算机为智能合约提供的弱-中等隐私是否是一个好主意。大多数人都喜欢隐私。目前，获取智能合约数据的唯一方法是与其交互。它决定什么数据应该允许某人访问。除非你能物理访问节点机器，并在其固态硬盘上四处找找。然而，这与云提供商的情况并无太大不同，原则上他们也可以查看托管服务的私人数据，并且，我们很快就可以在节点机器上启用SEV-SNP，这将阻止甚至那些具有物理访问权限的人窥探，除非他们拥有特殊技能并愿意投入大量时间。

关于“开放”NNS的问题

我们可以论证，因为NNS运行整个网络，所以它需要特殊的监督，这是一个特殊的案例。我原则上并不反对这种论证。但就风险而言，我认为我更担心在NNS中将每个人的投票、神经元、余额等公开所带来的后果。民主依赖于隐私来防止胁迫和报复。某些人要求此技术功能的真正原因与数学安全无关，而与他们想知道为什么自己提交的提案没有被采纳的想法有很大关系，或许还有一个潜意识的相关信念，即如果能揭示那些反对他们的人，他们会更容易达到目的。在我看来，这看起来像一种潜在的灾难性的前进方式。