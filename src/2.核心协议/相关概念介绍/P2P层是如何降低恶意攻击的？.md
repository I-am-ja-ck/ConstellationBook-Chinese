# P2P层是如何降低恶意攻击的？

P2P 层用多种方法来降低恶意行为的影响，确保子网中的副本能够高效且安全地进行通信。以下是 P2P 层如何处理潜在恶意行为的几个关键点：

**利用加密哈希确保完整性**：当副本收到一个工件的通知时，通知中会包含工件的加密哈希。副本下载工件后，会对下载内容应用相同的加密哈希函数。如果生成的哈希与通知中的哈希匹配，工件才被认为是有效的并继续处理。这样可以防止有恶意的副本发送被篡改的工件内容。

**客户端验证**：即使有恶意副本发送了一个哈希匹配的工件，客户端组件（如共识层组件）在处理或转发工件给其他副本之前，还需进行验证。这包括验证签名或检查工件是否符合预期的格式和规则。

**选择性下载工件**：P2P 层收到通知时不会立即下载工件。相反，副本会根据通知内容和自身状态来决定是否下载工件。这可以减少恶意副本通过不必要或恶意工件淹没网络的影响。

**冗余和容错**：下载可分为多个数据块的大型工件时，P2P 层会尝试从发布了工件的多个副本下载数据块。这提高了下载速度和带宽利用率。同时，在副本出现恶意行为或故障时，它还具有容错功能。

**经过验证的连接**：P2P 层的底层传输组件在子网中的副本之间建立基于 TLS 和 TCP 的安全连接。副本使用私钥进行相互认证，确保只有同一子网的副本才能通信。这减少了未授权副本将恶意流量注入子网的风险。

**监控和重新发送请求**：P2P 层持续监测连接质量和收到的工件。如果副本遇到工件问题，比如丢失或无效的数据，它可以向对方副本请求重新发送工件。这个机制有助于从恶意副本可能引发的问题中恢复。

